<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>英単語学習アプリ</title>
    <style>
        /* htmlのbodyタグ内のテキストを中央揃え，フォントをArialに，隣接する要素との距離を20px空けるようにしている*/
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            margin: 20px;
        }
        /* 練習関係のボタンやドロップダウンが入っているsectionクラスが入るコンテナの設定．枠線の外がわの設定 */
        .container { 
            display: flex; /* cssでレイアウト調整機能*/
            justify-content: space-around; /* 左右のスペースを確保 */
            margin-top: 20px;/*コンテナの上部20px文を空けている*/
        }
        /* 枠線とその内側の余白や幅の設定 */
        .section {
            border: 1px solid #ccc;
            padding: 20px;
            width: 40%;
        }
        /* 表示非表示を管理するクラス */
        .hidden {
            display: none;
        }
    </style>
    <script>
        let wordList = []; // 単語リストを保存する配列
        let totalQuestions = 0; //出題する問題数．ドロップダウンで洗濯した値が入る
        let isCanceled = false; //中止状態を管理する変数．中止ボタンを押した時に機能する

        // 単語を登録する関数
        function registerWord() {
            const english = prompt("英語を入力してください:");
            if (!english) return; /* 入力がなければ終了する */
            const japanese = prompt("日本語の意味を入力してください:");
            if (!japanese) return;　/* 入力がなければ終了する */
            wordList.push({ english, japanese }); /*　入力した英語と日本語を１つのオブジェクトとして単語リストの配列に追加　*/
            alert("単語を登録しました！");
        }

        // 単語を一度に複数登録する関数
        function registerMultipleWords() {
            const data = prompt("英語と日本語のペアをカンマ区切りで入力してください（例: dog,犬,cat,猫）:");/* 文字列で受け取る　*/
            if (!data) return;　/* 入力がなければ終了する */
            const arr = data.split(",");　/* カンマで分割して配列にする */
            for (let i = 0; i < arr.length; i += 2) {　/* 英語と日本語のセットで２つずつ処理する　*/
                /* ?によって，その左側がnullかundefinedなら処理を中断してundefinedを返す．エラーを失くす工夫である．これを使わないとnullかundefinedでエラーになる */
                /* trim()によって余計な空白を取り除いている */
                const eng = arr[i]?.trim();
                const jap = arr[i + 1]?.trim();
                /* 英語と日本語の入力に空白などが無ければ，単語リストにオブジェクトとして登録 */
                if (eng && jap) wordList.push({ english: eng, japanese: jap });
            }
            alert("単語を一気に登録しました！");
        }

        // 単語一覧を表示する関数
        function showWordList() {
            /*単語リストに何も登録していなかったときの処理*/
            if (!wordList.length) return alert("登録されている単語がありません。");
            let txt = "登録されている単語一覧:\n";
            /* アロー関数で書くことによって，関数定義を減らしている． プログラムを短くするための工夫である．*/
            /* 配列のインデックスを先頭から順に参照してそのオブジェクトを出力 */
            wordList.forEach((w, i) => txt += `${i + 1}. ${w.english} - ${w.japanese}\n`);
            alert(txt);/*一覧をalertをとして表示*/
        }

        // 単語を削除する関数
        function removeWord() {
            /* 単語が登録されていないときの処理 */
            if (!wordList.length) return alert("登録されている単語がありません。");
            let txt = "削除したい単語の番号を入力してください:\n";
            /* ユーザーが使いやすいように，登録されている単語の一覧を表示している．消したい単語に対応するオブジェクトの番号を選ぶ */
            wordList.forEach((w, i) => txt += `${i + 1}. ${w.english} - ${w.japanese}\n`);
            /* 入力したのは配列の最初を1とした時なので入力した番号を配列のインデックスと合うように調整 */
            const idx = parseInt(prompt(txt), 10) - 1;
            /* 入力が数値でなかったり，範囲外なら処理を中止する */
            if (isNaN(idx) || idx < 0 || idx >= wordList.length) return alert("無効な番号が入力されました。");
            /*spliceは引数に記入したインデックスから，指定した個数分の要素を配列から削除するメソッド．ここでは指定したインデックス１つのみを削除している*/
            /* spliceは配列を返すので，取り出した１つのオブジェクトしかない配列から，０番目のオブジェクトを取り出す */
            const removed = wordList.splice(idx, 1)[0];
            /* 何を排除したかわかるようにアラートで伝えている */
            alert(`単語「${removed.english} - ${removed.japanese}」を削除しました。`);
        }

        // 全ての単語を削除する関数
        function removeAllWords() {
            /* 単語が登録されていないときの処理 */
            if (!wordList.length) return alert("登録されている単語がありません。");
            /*よくある最終確認をするもの．OKとキャンセルをきく*/
            if (confirm("本当に全ての単語を削除しますか？")) {
                wordList = []; /* 単語リストを空の配列にする */
                alert("全ての単語を削除しました。");
            }
        }

        // 問題数を設定する関数
        function setQuestionCount(val) {
            /*　　ドロップダウンで”全問”を選んでいればvalueを'all'にしているので，単語リスト長が問題数になり，他の数を選んでいれば，対応するvalueを問題数として設定する*/
            totalQuestions = (val === 'all') ? wordList.length : parseInt(val, 10);
        }

        // 練習を開始する関数.modeは和訳か英訳を引数で識別している
        function startPractice(mode) {
            /* 単語が登録されていないときの処理 */
            if (!wordList.length) return alert("登録されている単語がありません。");
            isCanceled = false;　/* 練習が中止されたかどうかの状態を管理する変数 */
            totalQuestions = totalQuestions || wordList.length; /* 選択された問題数．未設定であれば全問とする */
            let correctCount = 0;　/* 正答数 */
            let asked = 0;　/* 出題済みの問題数 */
            const used = [];　/* 出題済みのオブジェクトのインデックスを記録する配列 */

            /* 問題を出題する関数 */
            function showQuestion() {
                /* 中断ボタンが押されたら，練習している部分のdivを非表示にする */
                if (isCanceled) {
                    hidePractice();
                    return;
                }
                /* 全問出題したら終了する．練習している部分のdivを非表示にする */
                if (asked >= totalQuestions) {
                    alert(`練習終了！ 正解数: ${correctCount}/${totalQuestions}`);
                    hidePractice();
                    return;
                }
                let idx;
                /* 単語リストからランダムに単語オブジェクトを選ぶ．既に出たインデックスであれば，（usedの配列にあれば),usedにないインデックスがでるまで繰り返す */
                do { idx = Math.floor(Math.random() * wordList.length); } while (used.includes(idx));
                used.push(idx);/* 使用済みとして追加 */
                const w = wordList[idx]; /* 対象のオブジェクトを取得 */
                asked++; /* 実施済み問題数の表示ように更新 */
                const display = `(${asked}/${totalQuestions})`;/*練習の進捗の表示*/
            
                if (mode === 'engToJap') {/* 英語から日本語の練習モード*/
                    document.getElementById('engToJapPractice').classList.remove('hidden'); /*和訳のdivを表示*/
                    document.getElementById('japToEngPractice').classList.add('hidden');/*英訳のdivを非表示*/
                    document.getElementById('engToJapQuestion').textContent = `英語: ${w.english} ${display}`;/*問題の単語と進捗状況を表示*/
                    /*input要素にカーソルを合わせて入力可能な状態に．デフォルトで""をinputの中に設定*/
                    document.getElementById("engToJapInput").value = "";
                    document.getElementById("engToJapInput").focus();
                } else {/*日本語から英語の練習モード*/
                    document.getElementById('japToEngPractice').classList.remove('hidden');
                    document.getElementById('engToJapPractice').classList.add('hidden');
                    document.getElementById('japToEngQuestion').textContent = `日本語: ${w.japanese} ${display}`;
                    document.getElementById("japToEngInput").value = "";
                    document.getElementById("japToEngInput").focus();
                }
                document.getElementById('currentCorrectAnswer').value = (mode === 'engToJap' ? w.japanese : w.english);  /* 正解の設定*/
            }

            /* 練習画面を隠す関数 */
            function hidePractice() {/* 練習画面のdivを両方とも非表示にする */
                document.getElementById('engToJapPractice').classList.add('hidden');
                document.getElementById('japToEngPractice').classList.add('hidden');
            }

            /* 答えをチェックする関数 */
            function checkAnswer(mode) {
                /* モードにしたがって適したモードのインプット要素から文字列を取得 */
                const input = document.getElementById(mode === 'engToJap' ? 'engToJapInput' : 'japToEngInput').value.trim();
                /* 正答を登録 */
                const correct = document.getElementById('currentCorrectAnswer').value;
                /* 正解と一致していた時の処理 */
                if (input === correct) { alert('正解です！'); correctCount++; }
                /* 不正解の場合の処理 */
                else alert(`不正解です！ 正しい答え: ${correct}`);
                /*  次の問題を表示 */
                showQuestion();
            }

            // ボタンとEnterキーのイベントの登録
            /*英to日ボタン*/
            document.getElementById('engToJapCheckButton').onclick = () => checkAnswer('engToJap');
            /*日to英ボタン*/
            document.getElementById('japToEngCheckButton').onclick = () => checkAnswer('japToEng');
            /* 二つのモードそれぞれの中止ボタン */
            document.getElementById('engToJapCancelButton').onclick = () => { if (confirm('練習を中止しますか？')) { isCanceled = true; hidePractice(); } };
            document.getElementById('japToEngCancelButton').onclick = () => { if (confirm('練習を中止しますか？')) { isCanceled = true; hidePractice(); } };

            //エンターキーでも解答できるようにする処理．円滑に操作を進めるための工夫
            document.getElementById('engToJapInput').addEventListener('keydown', (event) => {
                if (event.key === 'Enter') {
                    checkAnswer('engToJap');
                }
            });
            document.getElementById('japToEngInput').addEventListener('keydown', (event) => {
                if (event.key === 'Enter') {
                    checkAnswer('japToEng');
                }
            });

            showQuestion();
        }
    </script>
</head>
<body>
    <h1>英単語学習アプリ</h1>
    <button onclick="registerWord()">単語を登録</button>
    <button onclick="registerMultipleWords()">単語を一気に登録</button>
    <button onclick="showWordList()">単語一覧</button>
    <button onclick="removeWord()">単語を削除</button>
    <button onclick="removeAllWords()">単語を全て削除</button>

    <div class="container">
        <div class="section">
            <h2>練習</h2>
            <label for="questionCount">問題数:</label>
            <!--練習する問題数を選ぶドロップダウンリスト -->
            <select id="questionCount" onchange="setQuestionCount(this.value)">
                <option value="5">5問</option>
                <option value="10">10問</option>
                <option value="20">20問</option>
                <option value="all">全部</option>
            </select>
            <!--練習モードを選ぶボタン-->
            <div>
                <button onclick="startPractice('engToJap')">英 to 日</button>
                <button onclick="startPractice('japToEng')">日 to 英</button>
            </div>
        </div>
    </div>
    <!-- 二つのモードの練習画面．練習開始時に選択した方のモードの画面が表示される-->
    <div id="engToJapPractice" class="hidden">
        <h2>英 to 日</h2>
        <p id="engToJapQuestion"></p>
        <input type="text" id="engToJapInput" placeholder="日本語を入力">
        <button id="engToJapCheckButton">答える</button>
        <button id="engToJapCancelButton">中止する</button>
    </div>

    <div id="japToEngPractice" class="hidden">
        <h2>日 to 英</h2>
        <p id="japToEngQuestion"></p>
        <input type="text" id="japToEngInput" placeholder="英語を入力">
        <button id="japToEngCheckButton">答える</button>
        <button id="japToEngCancelButton">中止する</button>
    </div>

    <input type="hidden" id="currentCorrectAnswer">
</body>
</html>